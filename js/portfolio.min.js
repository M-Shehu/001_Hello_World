/*!
 * Start Bootstrap - Shehu's Portfolio v1.0.0 (https://startbootstrap.com/template-overviews/stylish-portfolio)
 * Copyright 2013-2019 Muhammad Shehu
 * Licensed under MIT (https://github.com/BlackrockDigital/001_HelloWorld/blob/master/LICENSE)
 */

var container,stats,clock,gui,mixer,actions,activeAction,previousAction,camera,scene,renderer,model,face;!1===WEBGL.isWebGLAvailable()&&document.body.appendChild(WEBGL.getWebGLErrorMessage());var api={state:"Idle"};function init(){container=document.createElement("div"),document.getElementById("robot").appendChild(container),(camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.25,100)).position.set(-5,3,10),camera.lookAt(new THREE.Vector3(0,2,0)),(scene=new THREE.Scene).background=new THREE.Color(16777215),scene.fog=new THREE.Fog(14737632,20,100),clock=new THREE.Clock;var e=new THREE.HemisphereLight(16777215,4473924);e.position.set(0,20,0),scene.add(e),(e=new THREE.DirectionalLight(16777215)).position.set(0,20,10),scene.add(e),(new THREE.GLTFLoader).load("js/models/gltf/RobotExpressive/RobotExpressive.glb",function(e){model=e.scene,scene.add(model)},void 0,function(e){console.error(e)}),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio/2),renderer.setSize(window.innerWidth/2,window.innerHeight/2),renderer.gammaOutput=!0,renderer.gammaFactor=2.2,container.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1),stats=new Stats}function createEmoteCallback(e){api[e]=function(){fadeToAction(e,.2),mixer.addEventListener("finished",restoreState)}}function restoreState(){mixer.removeEventListener("finished",restoreState),fadeToAction(api.state,.2)}function createGUI(e,n){var i=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],t=["Jump","Yes","No","Wave","Punch","ThumbsUp"];gui=new dat.GUI,mixer=new THREE.AnimationMixer(e),actions={};for(var a=0;a<n.length;a++){var o=n[a],r=mixer.clipAction(o);actions[o.name]=r,(0<=t.indexOf(o.name)||4<=i.indexOf(o.name))&&(r.clampWhenFinished=!0,r.loop=THREE.LoopOnce)}var c=gui.addFolder("States");c.add(api,"state").options(i).onChange(function(){fadeToAction(api.state,.5)}),c.open();var d=gui.addFolder("Emotes");function s(e){api[e]=function(){fadeToAction(e,.2),mixer.addEventListener("finished",m)},d.add(api,e)}function m(){mixer.removeEventListener("finished",m),fadeToAction(api.state,.2)}for(a=0;a<t.length;a++)s(t[a]);d.open(),face=e.getObjectByName("Head_2");var l=Object.keys(face.morphTargetDictionary),p=gui.addFolder("Expressions");for(a=0;a<l.length;a++)p.add(face.morphTargetInfluences,a,0,1,.01).name(l[a]);(activeAction=actions.Idle).play(),p.open()}function fadeToAction(e,n){previousAction=activeAction,activeAction=actions[e],previousAction!==activeAction&&previousAction.fadeOut(n),activeAction.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(n).play()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){var e=clock.getDelta();mixer&&mixer.update(e),requestAnimationFrame(animate),renderer.render(scene,camera),stats.update()}init(),animate(),document.getElementById("robot").addEventListener("click",function(){createEmoteCallback("Wave"),(activeAction=actions.Idle).play()}),mixer=new THREE.AnimationMixer(model),(activeAction=actions.Idle).play();