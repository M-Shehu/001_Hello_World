/*!
 * Start Bootstrap - Shehu's Portfolio v1.0.0 (https://shehu.dev)
 * Copyright 2013-2019 Muhammad Shehu
 * Licensed under MIT (https://github.com/BlackrockDigital/001_HelloWorld/blob/master/LICENSE)
 */

var container,stats,clock,gui,mixer,actions,activeAction,previousAction,focalPoint,camera,scene,renderer,model,face,controls,cameraSetX,cameraSetY,cameraSetZ,cameraLookAtY,cameraLookAtZ;!1===WEBGL.isWebGLAvailable()&&document.body.appendChild(WEBGL.getWebGLErrorMessage());var targetRotation=0,targetRotationOnMouseDown=0,windowHalfX=window.innerWidth/2,dialogCount=0;function checkDeviceSize(e){focalPoint=e.matches?(cameraSetY=3,cameraSetZ=32,cameraLookAtY=4,cameraLookAtZ=20,30):(cameraSetY=3,cameraSetZ=10,cameraLookAtY=2,cameraLookAtZ=0,60)}var x=window.matchMedia("(min-width: 992px)");checkDeviceSize(x),x.addListener(checkDeviceSize);var mouseX=0,mouseXOnMouseDown=0,api={state:"Idle"};function init(){container=document.createElement("div"),document.getElementById("robot").appendChild(container),(camera=new THREE.PerspectiveCamera(focalPoint,window.innerWidth/window.innerHeight,.25,100)).position.set(-5,3,cameraSetZ),camera.lookAt(new THREE.Vector3(0,cameraLookAtY,cameraLookAtZ)),(scene=new THREE.Scene).background=new THREE.Color(16777215),scene.fog=new THREE.Fog(14737632,20,100),clock=new THREE.Clock;var e=new THREE.HemisphereLight(16777215,4473924);function n(e){mouseX=e.clientX-windowHalfX,targetRotation=targetRotationOnMouseDown+.02*(mouseX-mouseXOnMouseDown)}function t(){document.removeEventListener("mousemove",n,!1),document.removeEventListener("mouseup",t,!1),document.removeEventListener("mouseout",i,!1)}function i(){document.removeEventListener("mousemove",n,!1),document.removeEventListener("mouseup",t,!1),document.removeEventListener("mouseout",i,!1)}e.position.set(0,20,0),scene.add(e),(e=new THREE.DirectionalLight(16777215)).position.set(0,20,10),scene.add(e),document.addEventListener("mousedown",function(e){e.preventDefault(),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",t,!1),document.addEventListener("mouseout",i,!1),mouseXOnMouseDown=e.clientX-windowHalfX,targetRotationOnMouseDown=targetRotation},!1),document.addEventListener("touchstart",function(e){1==e.touches.length&&(e.preventDefault(),mouseXOnMouseDown=e.touches[0].pageX-windowHalfX,targetRotationOnMouseDown=targetRotation)},!1),document.addEventListener("touchmove",function(e){1==e.touches.length&&(e.preventDefault(),mouseX=e.touches[0].pageX-windowHalfX,targetRotation=targetRotationOnMouseDown+.05*(mouseX-mouseXOnMouseDown))},!1);var o=new THREE.Mesh(new THREE.PlaneBufferGeometry(2e3,2e3),new THREE.MeshPhongMaterial({color:10066329,depthWrite:!1}));o.rotation.x=-Math.PI/2,scene.add(o);var a=new THREE.GridHelper(200,40,0,0);a.material.opacity=.2,a.material.transparent=!0,scene.add(a),(new THREE.GLTFLoader).load("js/models/gltf/RobotExpressive/RobotExpressive.glb",function(e){model=e.scene,scene.add(model),initRobot(model,e.animations)},void 0,function(e){console.error(e)}),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.gammaOutput=!0,renderer.gammaFactor=2.2,container.appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function initRobot(e,n){mixer=new THREE.AnimationMixer(e),actions={},unlimitedActions={};for(var t=0;t<n.length;t++){var i=n[t],o=mixer.clipAction(i);actions[i.name]=o}face=e.getObjectByName("Head_2");Object.keys(face.morphTargetDictionary);(activeAction=actions.Idle).play(),document.getElementById("dialog-bubble").addEventListener("click",function(){a(++dialogCount)});var a=function(e){switch(e){case 0:return d("Wave",.2),mixer.addEventListener("finished",c),void activeAction.play();case 1:return d("Dance",.2),mixer.addEventListener("finished",c),void activeAction.play();case 2:return d("Idle",.2),mixer.addEventListener("finished",c),activeAction.play(),void(face.morphTargetInfluences=[1.5,0,0]);case 3:return face.morphTargetInfluences=[0,0,0],d("ThumbsUp",.2),mixer.addEventListener("finished",c),void activeAction.play();case 4:return d("Dance",.2),mixer.addEventListener("finished",c),void activeAction.play();case 5:return d("Idle",.2),mixer.addEventListener("finished",c),void activeAction.play()}};function c(){mixer.removeEventListener("finished",c),d(api.state,.2)}function d(e,n,t){previousAction=activeAction,activeAction=actions[e],previousAction!==activeAction&&previousAction.fadeOut(n),t&&(activeAction.clampWhenFinished=!0,activeAction.loop=THREE.LoopOnce),activeAction.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(n).play()}a(dialogCount),document.getElementById("wave").addEventListener("click",function(){d("Wave",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("dance").addEventListener("click",function(){d("Dance",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("run").addEventListener("click",function(){d("Running",.2),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("walk").addEventListener("click",function(){d("Walking",.2),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("angry").addEventListener("click",function(){face.morphTargetInfluences=[1.5,0,0]}),document.getElementById("happy").addEventListener("click",function(){face.morphTargetInfluences=[0,0,0]}),document.getElementById("surprised").addEventListener("click",function(){face.morphTargetInfluences=[0,1,0]}),document.getElementById("sad").addEventListener("click",function(){face.morphTargetInfluences=[0,.5,1.5]}),document.getElementById("idle").addEventListener("click",function(){d("Idle",.2),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("robot").addEventListener("click",function(){d("Death",.2),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("punch").addEventListener("click",function(){d("Punch",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("sitting").addEventListener("click",function(){d("Sitting",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("standing").addEventListener("click",function(){d("Standing",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("jump").addEventListener("click",function(){d("Jump",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("yes").addEventListener("click",function(){d("Yes",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("no").addEventListener("click",function(){d("No",.2,!0),mixer.addEventListener("finished",c),activeAction.play()}),document.getElementById("thumbsup").addEventListener("click",function(){d("ThumbsUp",.2,!0),mixer.addEventListener("finished",c),activeAction.play()})}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){var e=clock.getDelta();mixer&&mixer.update(e),model&&(model.rotation.y+=.05*(targetRotation-model.rotation.y)),requestAnimationFrame(animate),renderer.render(scene,camera)}init(),animate();